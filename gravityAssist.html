<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gravity Assist v4</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:sans-serif; }
canvas { display:block; }
#ui { position:absolute; top:10px; left:10px; color:white; }
</style>
</head>
<body>
<div id="ui">
Score: <span id="score">0</span> | Level: <span id="level">1</span> | Boosters: <span id="boosters">0</span>
</div>
<canvas id="c"></canvas>
<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
const scoreEl=document.getElementById('score');
const levelEl=document.getElementById('level');
const boostersEl=document.getElementById('boosters');

let W,H;
function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; }
window.addEventListener('resize',resize);
resize();

// Player
let player={x:100, y:H/2, vx:0, vy:0, color:'cyan', radius:12, score:0, boosters:0};

// Mouse gravity
let mouse={x:player.x, y:player.y};
window.addEventListener('mousemove', e=>{ mouse.x=e.clientX; mouse.y=e.clientY; });

// Side-scrolling
let scrollSpeed=2;
let level=1;

// Targets
let targets=[], numTargets=5;

// Obstacles (red circles)
let obstacles=[], numObstacles=3;

// Boosters
let boosterList=[], numBoosters=2;

// Monster
let monsters=[];

// Fireworks
let fireworks=[];

// Initialize targets
function spawnTargets(){
    targets=[];
    for(let i=0;i<numTargets;i++){
        targets.push({
            x: W + Math.random()*W*2,
            y: Math.random()*H,
            radius:10+Math.random()*5,
            color:`hsl(${Math.random()*360},80%,60%)`
        });
    }
}

// Initialize obstacles
function spawnObstacles(){
    obstacles=[];
    for(let i=0;i<numObstacles;i++){
        obstacles.push({
            x: W + Math.random()*W*3,
            y: Math.random()*H,
            radius:20+Math.random()*10
        });
    }
}

// Initialize boosters
function spawnBoosters(){
    boosterList=[];
    for(let i=0;i<numBoosters;i++){
        boosterList.push({
            x: W + Math.random()*W*4,
            y: Math.random()*H,
            radius:16, // BIGGER BOOSTER
            color:'magenta'
        });
    }
}

// Initialize monsters
function spawnMonsters(){
    monsters=[];
    if(level>=3){
        monsters.push({
            x: W + 300,
            y: Math.random()*(H-100)+50,
            radius:30,
            vx:-1.5
        });
    }
}

// Firework particle
function createFirework(x,y,intensity){
    for(let i=0;i<intensity*10;i++){
        fireworks.push({
            x:x, y:y,
            vx:(Math.random()-0.5)*intensity*3,
            vy:(Math.random()-0.5)*intensity*3,
            life:60+Math.random()*30,
            color:`hsl(${Math.random()*360},80%,60%)`
        });
    }
}

// Draw firework
function drawFireworks(){
    fireworks.forEach(f=>{
        ctx.fillStyle=f.color;
        ctx.beginPath();
        ctx.arc(f.x,f.y,2,0,Math.PI*2);
        ctx.fill();
        f.x += f.vx;
        f.y += f.vy;
        f.vy += 0.05; // gravity on particles
        f.life--;
    });
    fireworks = fireworks.filter(f=>f.life>0);
}

// Draw player
function drawPlayer(){
    ctx.fillStyle=player.color;
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);
    ctx.fill();
}

// Draw targets
function drawTargets(){
    targets.forEach(t=>{
        ctx.fillStyle=t.color;
        ctx.beginPath();
        ctx.arc(t.x,t.y,t.radius,0,Math.PI*2);
        ctx.fill();
    });
}

// Draw obstacles
function drawObstacles(){
    ctx.strokeStyle='rgba(255,0,0,0.6)';
    ctx.lineWidth=3;
    obstacles.forEach(o=>{
        ctx.beginPath();
        ctx.arc(o.x,o.y,o.radius,0,Math.PI*2);
        ctx.stroke();
    });
}

// Draw boosters
function drawBoosters(){
    boosterList.forEach(b=>{
        ctx.fillStyle=b.color;
        ctx.beginPath();
        ctx.moveTo(b.x, b.y - b.radius);
        ctx.lineTo(b.x - b.radius, b.y + b.radius);
        ctx.lineTo(b.x + b.radius, b.y + b.radius);
        ctx.closePath();
        ctx.fill();
    });
}

// Draw monsters
function drawMonsters(){
    monsters.forEach(m=>{
        ctx.fillStyle='darkred';
        ctx.beginPath();
        ctx.arc(m.x,m.y,m.radius,0,Math.PI*2);
        ctx.fill();
    });
}

// Trail
let trail=[];
function drawTrail(){
    trail.push({x:player.x, y:player.y, color:player.color});
    if(trail.length>100) trail.shift();
    trail.forEach((p,i)=>{
        ctx.fillStyle=p.color;
        ctx.globalAlpha = i/trail.length*0.6;
        ctx.beginPath();
        ctx.arc(p.x,p.y,5,0,Math.PI*2);
        ctx.fill();
    });
    ctx.globalAlpha=1;
}

// Update player
function updatePlayer(){
    let dx = mouse.x - player.x;
    let dy = mouse.y - player.y;
    player.vx += dx*0.01;
    player.vy += dy*0.01;
    player.vx *= 0.92;
    player.vy *= 0.92;
    player.x += player.vx;
    player.y += player.vy;

    if(player.y<0) player.y=0;
    if(player.y>H) player.y=H;
}

// Update world
function updateWorld(){
    targets.forEach(t=> t.x -= scrollSpeed);
    obstacles.forEach(o=> t=o?o.x-=scrollSpeed:0);
    boosterList.forEach(b=> b.x -= scrollSpeed);
    monsters.forEach(m=> m.x += m.vx);

    targets.forEach(t=>{ if(t.x<-50){ t.x=W+Math.random()*W; t.y=Math.random()*H; t.color=`hsl(${Math.random()*360},80%,60%)`; }});
    obstacles.forEach(o=>{ if(o.x<-50){ o.x=W+Math.random()*W; o.y=Math.random()*H; }});
    boosterList.forEach(b=>{ if(b.x<-50){ b.x=W+Math.random()*W*2; b.y=Math.random()*H; }});
    monsters.forEach(m=>{ if(m.x<-50){ m.x=W+Math.random()*W; m.y=Math.random()*H; }});
}

// Collisions
function checkCollisions(){
    // Targets
    targets.forEach(t=>{
        let dx=player.x-t.x, dy=player.y-t.y;
        let d=Math.sqrt(dx*dx+dy*dy);
        if(d<player.radius+t.radius){
            player.color=t.color;
            player.score++;
            scoreEl.innerText = player.score;
            t.x=W + Math.random()*W;
            t.y=Math.random()*H;
            t.color=`hsl(${Math.random()*360},80%,60%)`;
        }
    });

    // Obstacles
    obstacles.forEach(o=>{
        let dx=player.x-o.x, dy=player.y-o.y;
        let d=Math.sqrt(dx*dx+dy*dy);
        if(d<player.radius+o.radius){
            if(player.boosters>0){
                player.boosters--;
                boostersEl.innerText = player.boosters;
                // destroy obstacle and trigger firework
                createFirework(o.x,o.y, Math.ceil(o.radius/10));
                player.score += Math.ceil(o.radius/10); // points based on size
                scoreEl.innerText = player.score;
                o.x=W+Math.random()*W;
                o.y=Math.random()*H;
            } else {
                player.score = Math.max(0,player.score-2);
                scoreEl.innerText=player.score;
                player.x=100;
                player.y=H/2;
            }
        }
    });

    // Boosters
    boosterList.forEach(b=>{
        let dx=player.x-b.x, dy=player.y-b.y;
        let d=Math.sqrt(dx*dx+dy*dy);
        if(d<player.radius+b.radius){
            player.boosters++;
            boostersEl.innerText=player.boosters;
            b.x=W+Math.random()*W*2;
            b.y=Math.random()*H;
        }
    });

    // Monsters
    monsters.forEach(m=>{
        let dx=player.x-m.x, dy=player.y-m.y;
        let d=Math.sqrt(dx*dx+dy*dy);
        if(d<player.radius+m.radius){
            if(player.boosters>=3){
                player.boosters-=3;
                boostersEl.innerText=player.boosters;
                createFirework(m.x,m.y,5); // big firework
                player.score += 5; // points based on monster size
                scoreEl.innerText = player.score;
                m.x=W + Math.random()*W; 
                m.y=Math.random()*H;
            } else {
                player.score = Math.max(0,player.score-5);
                scoreEl.innerText=player.score;
                player.x=100;
                player.y=H/2;
            }
        }
    });
}

// Level
function checkLevel(){
    let newLevel = Math.floor(player.score/10)+1;
    if(newLevel>level){
        level=newLevel;
        scrollSpeed+=0.5;
        numTargets+=1;
        numObstacles+=1;
        spawnTargets();
        spawnObstacles();
        spawnBoosters();
        spawnMonsters();
        levelEl.innerText = level;
    }
}

// Animate
function animate(){
    ctx.fillStyle='rgba(0,0,0,0.15)';
    ctx.fillRect(0,0,W,H);

    updatePlayer();
    updateWorld();
    checkCollisions();
    checkLevel();

    drawTrail();
    drawTargets();
    drawObstacles();
    drawBoosters();
    drawMonsters();
    drawPlayer();
    drawFireworks();

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
